<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–û—Ç–∫—Ä—ã—Ç—å VPN –≤ V2rayTUN</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			margin: 0;
			padding: 20px;
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
		}

		.container {
			text-align: center;
			max-width: 400px;
			background: rgba(255, 255, 255, 0.1);
			padding: 40px;
			border-radius: 20px;
			backdrop-filter: blur(10px);
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
		}

		.spinner {
			width: 40px;
			height: 40px;
			border: 4px solid rgba(255, 255, 255, 0.3);
			border-radius: 50%;
			border-top-color: white;
			animation: spin 1s ease-in-out infinite;
			margin: 0 auto 20px;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		.app-button {
			display: inline-block;
			background: #007AFF;
			color: white;
			text-decoration: none;
			padding: 15px 30px;
			border-radius: 12px;
			font-weight: 500;
			margin-top: 20px;
			transition: all 0.3s ease;
		}

		.app-button:hover {
			background: #005fcf;
			transform: translateY(-2px);
		}

		.manual-config {
			margin-top: 30px;
			padding: 20px;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 12px;
			font-family: monospace;
			font-size: 12px;
			word-break: break-all;
			display: none;
		}

		.show-config {
			color: rgba(255, 255, 255, 0.8);
			text-decoration: underline;
			cursor: pointer;
			font-size: 14px;
			margin-top: 15px;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="spinner"></div>
		<h2>üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º V2rayTUN</h2>
		<p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤–∞—Å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...</p>

		<div id="fallback" style="display: none;">
			<p>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
			<a href="https://apps.apple.com/app/v2raytun/id1599608807" class="app-button">
				üì± –°–∫–∞—á–∞—Ç—å V2rayTUN
			</a>
			<div class="show-config" onclick="toggleConfig()">
				üìã –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
			</div>
			<div class="manual-config" id="config"></div>
			<div class="manual-config" id="debug" style="display: block; background: rgba(255,0,0,0.2);">
				<strong>Debug info:</strong><br>
				<div id="debug-info"></div>
			</div>
		</div>
	</div>

	<script>
		const urlParams = new URLSearchParams(window.location.search)
		const configKey = urlParams.get('key')
		const platform = urlParams.get('platform') || 'ios'

		if (configKey) {
			// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–æ–Ω–∞ —É–∂–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞ –≤ URL)
			const decodedConfig = decodeURIComponent(configKey)

			console.log('Original config:', decodedConfig)

			// –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			document.getElementById('debug-info').innerHTML = `
				URL param 'key': ${configKey}<br>
				Decoded config: ${decodedConfig}<br>
				Config starts with: ${decodedConfig.substring(0, 20)}...<br>
				Config length: ${decodedConfig.length}
			`

			// –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã deep link
			const formats = [
				`v2raytun://add/${decodedConfig}`,
				`v2raytun://import/${decodedConfig}`,
				`v2raytun://config/${decodedConfig}`,
				`v2raytun://add/${btoa(decodedConfig)}`, // base64
				`v2raytun://import/${btoa(decodedConfig)}`, // base64
			]

			let currentFormat = 0
			const v2rayTunLink = formats[currentFormat]

			console.log('Deep link:', v2rayTunLink)

			setTimeout(() => {
				window.location.href = v2rayTunLink
			}, 1000)

			// –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π
			setTimeout(() => {
				if (currentFormat < formats.length - 1) {
					currentFormat++
					console.log('Trying format:', formats[currentFormat])
					window.location.href = formats[currentFormat]
				}
			}, 2000)

			setTimeout(() => {
				document.getElementById('fallback').style.display = 'block'
				document.querySelector('.spinner').style.display = 'none'
				document.querySelector('h2').textContent = 'üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ V2rayTUN'
				document.querySelector('p').textContent = '–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'

				document.getElementById('config').textContent = decodedConfig
			}, 3000)

			if (platform === 'ios') {
				setTimeout(() => {
					const iframe = document.createElement('iframe')
					iframe.style.display = 'none'
					iframe.src = v2rayTunLink
					document.body.appendChild(iframe)

					setTimeout(() => {
						document.body.removeChild(iframe)
					}, 500)
				}, 1500)
			}
		} else {
			document.querySelector('.spinner').style.display = 'none'
			document.querySelector('h2').textContent = '‚ùå –û—à–∏–±–∫–∞'
			document.querySelector('p').textContent = '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞'
			document.getElementById('fallback').style.display = 'block'
		}

		function toggleConfig() {
			const config = document.getElementById('config')
			const button = document.querySelector('.show-config')
			if (config.style.display === 'none' || !config.style.display) {
				config.style.display = 'block'
				button.textContent = 'üîº –°–∫—Ä—ã—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é'
			} else {
				config.style.display = 'none'
				button.textContent = 'üìã –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞'
			}
		}

		if (platform === 'android' && configKey) {
			// –î–ª—è Android —Ç–∞–∫–∂–µ —É–±–∏—Ä–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
			const androidIntent = `intent://add/${decodedConfig}#Intent;scheme=v2raytun;package=com.v2raytun.android;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.v2raytun.android;end`

			setTimeout(() => {
				window.location.href = androidIntent
			}, 1200)
		}
	</script>
</body>

</html>