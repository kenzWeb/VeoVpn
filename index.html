<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>–û—Ç–∫—Ä—ã—Ç—å VPN –≤ V2rayTUN</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			margin: 0;
			padding: 20px;
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
		}

		.container {
			text-align: center;
			max-width: 400px;
			background: rgba(255, 255, 255, 0.1);
			padding: 40px;
			border-radius: 20px;
			backdrop-filter: blur(10px);
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
		}

		.spinner {
			width: 40px;
			height: 40px;
			border: 4px solid rgba(255, 255, 255, 0.3);
			border-radius: 50%;
			border-top-color: white;
			animation: spin 1s ease-in-out infinite;
			margin: 0 auto 20px;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		.app-button {
			display: inline-block;
			background: #007AFF;
			color: white;
			text-decoration: none;
			padding: 15px 30px;
			border-radius: 12px;
			font-weight: 500;
			margin-top: 20px;
			transition: all 0.3s ease;
		}

		.app-button:hover {
			background: #005fcf;
			transform: translateY(-2px);
		}

		.manual-config {
			margin-top: 30px;
			padding: 20px;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 12px;
			font-family: monospace;
			font-size: 12px;
			word-break: break-all;
			display: none;
		}

		.show-config {
			color: rgba(255, 255, 255, 0.8);
			text-decoration: underline;
			cursor: pointer;
			font-size: 14px;
			margin-top: 15px;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="spinner"></div>
		<h2>üöÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º V2rayTUN</h2>
		<p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤–∞—Å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...</p>

		<div id="fallback" style="display: none;">
			<p>‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
			<a href="https://apps.apple.com/app/v2raytun/id1599608807" class="app-button">
				üì± –°–∫–∞—á–∞—Ç—å V2rayTUN
			</a>
			<div class="show-config" onclick="toggleConfig()">
				üìã –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
			</div>
			<div class="manual-config" id="config"></div>
			<div class="manual-config" id="debug" style="display: block; background: rgba(255,0,0,0.2);">
				<strong>Debug info:</strong><br>
				<div id="debug-info"></div>
			</div>
		</div>
	</div>

	<script>
		// –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
		const urlParams = new URLSearchParams(window.location.search)
		const configKey = urlParams.get('key')
		const platform = urlParams.get('platform') || 'ios'

		console.log('URL params:', {
			key: configKey,
			platform: platform,
			fullURL: window.location.href
		})

		if (configKey) {
			// –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ SupaVPN
			const decodedConfig = decodeURIComponent(configKey)

			console.log('Decoded config:', decodedConfig)

			// –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
			document.getElementById('debug-info').innerHTML = `
				<strong>URL:</strong> ${window.location.href}<br>
				<strong>Raw key param:</strong> ${configKey}<br>
				<strong>Decoded config:</strong> ${decodedConfig}<br>
				<strong>Config length:</strong> ${decodedConfig.length} chars<br>
				<strong>Starts with:</strong> ${decodedConfig.substring(0, 30)}...<br>
				<strong>Platform:</strong> ${platform}
			`

			// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —Ñ–æ—Ä–º–∞—Ç, –∫–∞–∫ SupaVPN
			const v2rayTunLink = `v2raytun://add/${decodedConfig}`

			console.log('Generated deep link:', v2rayTunLink)

			// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º debug —Å—Ä–∞–∑—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
			document.getElementById('fallback').style.display = 'block'
			document.querySelector('.spinner').style.display = 'none'

			// –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
			setTimeout(() => {
				console.log('Attempting to open:', v2rayTunLink)
				window.location.href = v2rayTunLink
			}, 2000)

			// –û–±–Ω–æ–≤–ª—è–µ–º UI —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
			setTimeout(() => {
				document.querySelector('h2').textContent = 'üì± –û—Ç–∫—Ä–æ–π—Ç–µ V2rayTUN –≤—Ä—É—á–Ω—É—é'
				document.querySelector('p').textContent = '–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∏–∂–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é'
				document.getElementById('config').textContent = decodedConfig
			}, 5000)

			// –î–ª—è iOS –¥–æ–±–∞–≤–ª—è–µ–º iframe –º–µ—Ç–æ–¥
			if (platform === 'ios') {
				setTimeout(() => {
					try {
						const iframe = document.createElement('iframe')
						iframe.style.display = 'none'
						iframe.src = v2rayTunLink
						document.body.appendChild(iframe)

						setTimeout(() => {
							if (document.body.contains(iframe)) {
								document.body.removeChild(iframe)
							}
						}, 1000)
					} catch (e) {
						console.log('iframe method failed:', e)
					}
				}, 3000)
			}

		} else {
			// –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ key
			document.querySelector('.spinner').style.display = 'none'
			document.querySelector('h2').textContent = '‚ùå –û—à–∏–±–∫–∞'
			document.querySelector('p').textContent = '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VPN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ URL'
			document.getElementById('fallback').style.display = 'block'
			document.getElementById('debug-info').innerHTML = `
				<strong>Error:</strong> No 'key' parameter found in URL<br>
				<strong>Current URL:</strong> ${window.location.href}<br>
				<strong>Available params:</strong> ${Array.from(urlParams.keys()).join(', ') || 'none'}
			`
		}

		function toggleConfig() {
			const config = document.getElementById('config')
			const button = document.querySelector('.show-config')
			if (config.style.display === 'none' || !config.style.display) {
				config.style.display = 'block'
				button.textContent = 'üîº –°–∫—Ä—ã—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é'
			} else {
				config.style.display = 'none'
				button.textContent = 'üìã –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞'
			}
		}
	</script>
</body>

</html>